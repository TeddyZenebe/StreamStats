var StreamStats;!function(e){var t=function(){function e(e,t,a,r){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=a,this.$logProvider=r,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngAnimate","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","wim_angular"]).config(t)}(StreamStats||(StreamStats={}));var configuration={};configuration.baseurls={MercuryService:"http://54.174.81.42/mercuryservices",MercuryAuth:"http://54.174.81.42/mercuryauth",RegressionService:"http://commons.wim.usgs.gov/regressionservice/models",KrigService:"http://commons.wim.usgs.gov/krigservice",NWISurl:"http://waterservices.usgs.gov/nwis",StreamStats:"http://streamstats09.cr.usgs.gov",StreamStatsServices:"http://ssdev.cr.usgs.gov",NSS:"http://commons.wim.usgs.gov/nssservices",SearchAPI:"http://txpub.usgs.gov/DSS/search_api/1.1/dataService/dataService.ashx",FARefGage:"http://wim.usgs.gov/arcgis/rest/services/CedarRiverMapper/IowaFlowAnywhere/MapServer",GISserver:"http://54.164.188.167:6080"},configuration.queryparams={NWISsite:"/site/?format=mapper,1.0&stateCd={0}&siteType=GL,OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS&hasDataTypeCd=iv",KrigService:"/krig?state={0}&xlocation={1}&ylocation={2}&sr={3}",RegressionScenarios:"/{0}/estimate?state={1}",statisticsGroupLookup:"/statisticgroups.json?region={0}&regressionregions={1}&unitsystems=2",statisticsGroupParameterLookup:"/scenarios.json?region={0}&statisticgroups={1}&regressionregions={2}&unitsystems=2",estimateFlows:"/scenarios/estimate.json?region={0}&statisticgroups={1}&regressionregions={2}&unitsystems=2",SSdelineation:"/streamstatsservices/watershed.{0}?rcode={1}&xlocation={2}&ylocation={3}&crs={4}&simplify=true&includeparameters=false&includeflowtypes=false&includefeatures=true",SSwatershedByWorkspace:"/streamstatsservices/watershed.{0}?rcode={1}&workspaceID={2}&crs={3}&simplify=true&includeparameters=false&includeflowtypes=false&includefeatures=true",SSeditBasin:"/streamstatsservices/watershed/edit.{0}?rcode={1}&workspaceID={2}&crs={3}&simplify=true&includeparameters=false&includeflowtypes=false&includefeatures=true",SSAvailableParams:"/streamstatsservices/parameters.json?rcode={0}&group={1}",SSComputeParams:"/streamstatsservices/parameters.json?rcode={0}&workspaceID={1}&includeparameters={2}",SSStateLayers:"/arcgis/rest/services/{0}_ss/MapServer?f=pjson",FARefGage:"/2/query?geometry={0}&geometryType=esriGeometryPoint&inSR={1}&spatialRel=esriSpatialRelIntersects&outFields=regions_local.Region_Agg,reference_gages.site_id,reference_gages.site_name,reference_gages.da_gis_mi2,reference_gages.lat_dd_nad,reference_gages.long_dd_na&returnGeometry=false&returnIdsOnly=false&returnCountOnly=false&returnZ=false&returnM=false&returnDistinctValues=false&f=pjson",regionService:"/arcgis/rest/services/ss_studyAreas_prod/MapServer/identify",COregulationService:"/arcgis/rest/services/Regulation/CORegulationSites/MapServer/exts/RegulationRESTSOE/Regulation",RegressionRegionQueryService:"/arcgis/rest/services/NSS/regions/MapServer/exts/PercentOverlayRESTSOE/PercentOverlay"},configuration.basemaps={tnmBaseMap:{name:"USGS National Map",visible:!0,type:"group",layerOptions:{layers:[{name:"tiles",url:"http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer",type:"agsTiled",layerOptions:{opacity:.8,minZoom:0,maxZoom:15,attribution:"<a href='http://www.doi.gov'>U.S. Department of the Interior</a> | <a href='http://www.usgs.gov'>U.S. Geological Survey</a> | <a href='http://www.usgs.gov/laws/policies_notices.html'>Policies</a>"}},{name:"dynamic",url:"http://services.nationalmap.gov/arcgis/rest/services/USGSTopoLarge/MapServer",type:"agsDynamic",layerOptions:{format:"png8",f:"image",position:"back",opacity:.7,zIndex:-100,minZoom:16,maxZoom:20,attribution:"<a href='http://www.doi.gov'>U.S. Department of the Interior</a> | <a href='http://www.usgs.gov'>U.S. Geological Survey</a> | <a href='http://www.usgs.gov/laws/policies_notices.html'>Policies</a>"}}]}},national:{name:"National Geographic",type:"agsBase",layer:"NationalGeographic",visible:!1},streets:{name:"ESRI Streets",type:"agsBase",layer:"Streets",visible:!0},topo:{name:"ESRI World Topographic",type:"agsBase",layer:"Topographic",visible:!1},oceans:{name:"ESRI Oceans",type:"agsBase",layer:"Oceans",visible:!1},gray:{name:"ESRI Gray",type:"agsBase",layer:"Gray",visible:!1},imagery:{name:"ESRI Imagery",type:"agsBase",layer:"Imagery",visible:!1},MapquestOAM:{name:"Mapquest Areal",url:"http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",visible:!1,type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}},MapquestHYB:{name:"Mapquest Hybrid",type:"group",visible:!1,layerOptions:{maxZoom:19,layers:[{name:"tiles",url:"http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"]}},{name:"roads",url:"http://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}}]}},mapquestOSM:{name:"Mapquest Streets",url:"http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",visible:!1,type:"xyz",layerOptions:{maxZoom:19,subdomains:["otile1","otile2","otile3","otile4"],attribution:"Tiles courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>. Map data (c) <a href='http://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a> contributors, CC-BY-SA."}}},configuration.overlayedLayers={SSLayer:{name:"National Layers",url:configuration.baseurls.StreamStats+"/arcgis/rest/services/ss_studyAreas_prod/MapServer",type:"agsDynamic",visible:!0,layerOptions:{zIndex:1,opacity:.6,format:"png8",f:"image"}},draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}},configuration.regions=[{RegionID:"AL",Name:"Alabama",Bounds:[[30.189622,-88.47203],[35.00888,-84.893486]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"AK",Name:"Alaska",Bounds:[[51,-179],[72,-140]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"AR",Name:"Arkansas",Bounds:[[33.004528,-94.618156],[36.499656,-89.644409]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"AS",Name:"American Samoa",Bounds:[[-14.375555,-170.82611],[-14.166389,-169.438323]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"AZ",Name:"Arizona",Bounds:[[31.329174,-114.815414],[37.004585,-109.044883]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"CA",Name:"California",Bounds:[[32.530426,-124.411186],[42.009826,-114.129486]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"CO",Name:"Colorado",Bounds:[[36.992225,-109.060806],[41.005611,-102.041984]],Layers:{CO_Regulation:{name:"Regulation Points",url:configuration.baseurls.GISserver+"/arcgis/rest/services/Regulation/CORegulationSites/MapServer",type:"agsDynamic",visible:!0,layerOptions:{zIndex:1,format:"png8",layers:[0],f:"image"}}},Applications:["Regulation"],ScenariosAvailable:!0},{RegionID:"CT",Name:"Connecticut",Bounds:[[40.982486,-73.729721],[42.049732,-71.788238]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"DE",Name:"Delaware",Bounds:[[38.449325,-75.788055],[39.840576,-75.042396]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"DC",Name:"District of Columbia",Bounds:[[38.801475,-77.120506],[38.995063,-76.909698]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"FL",Name:"Florida",Bounds:[[24.518321,-87.637229],[31.002105,-80.029022]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"GA",Name:"Georgia",Bounds:[[30.35713,-85.605514],[35.002037,-80.841957]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"GU",Name:"Guam",Bounds:[[13.234996,144.634155],[13.65361,144.953308]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"HA",Name:"Hawaii",Bounds:[[18.915493,-160.236068],[22.234394,-154.798583]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"ID",Name:"Idaho",Bounds:[[41.989837,-117.240196],[49.001522,-111.043617]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"IL",Name:"Illinois",Bounds:[[36.971115,-91.512626],[42.509479,-87.018081]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"IN",Name:"Indiana",Bounds:[[37.773048,-88.089744],[41.762321,-84.787673]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"IA",Name:"Iowa",Bounds:[[40.374542,-96.635665],[43.504646,-90.139312]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"KS",Name:"Kansas",Bounds:[[36.992221,-102.048553],[40.004512,-94.592735]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"KY",Name:"Kentucky",Bounds:[[36.496719,-89.573677],[39.147232,-81.964202]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"LA",Name:"Louisiana",Bounds:[[28.918104,-94.045776],[33.020599,-88.814056]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"ME",Name:"Maine",Bounds:[[43.064773,-71.082],[47.461883,-66.954002]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MD",Name:"Maryland",Bounds:[[37.911422,-79.487152],[39.724014,-75.045898]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MA",Name:"Massachusetts",Bounds:[[41.237003,-73.508407],[42.886661,-69.925399]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MI",Name:"Michigan",Bounds:[[41.6958,-90.418708],[48.304248,-82.122901]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MN",Name:"Minnesota",Bounds:[[43.502101,-97.238975],[49.38562,-89.487754]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MS",Name:"Mississippi",Bounds:[[30.174402,-91.654251],[34.998321,-88.097961]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MO",Name:"Missouri",Bounds:[[35.99509,-95.774414],[40.614028,-89.100593]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MT",Name:"Montana",Bounds:[[44.357688,-116.050735],[49.001808,-104.03971]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NE",Name:"Nebraska",Bounds:[[39.999885,-104.052841],[43.002796,-95.307998]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NV",Name:"Nevada",Bounds:[[35.002079,-120.005348],[42.000312,-114.039344]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NH",Name:"New Hampshire",Bounds:[[42.697776,-72.556434],[45.308731,-70.7135]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NJ",Name:"New Jersey",Bounds:[[38.92564,-75.567596],[41.357639,-73.89363]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NM",Name:"New Mexico",Bounds:[[33.027087,-118.366699],[44.777935,-98.5034179]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NX",Name:"New Mexico",Bounds:[[31.331899,-109.050102],[36.999423,-103.000656]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NY",Name:"New York",Bounds:[[40.499076,-79.763328],[45.017364,-71.85588]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"NC",Name:"North Carolina",Bounds:[[33.844467,-84.320968],[36.589008,-75.459503]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"ND",Name:"North Dakota",Bounds:[[45.93505,-104.049591],[49.001316,-96.555152]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"MP",Name:"Northern Mariana Islands",Bounds:[[14.105276,144.89859],[20.556385,145.870788]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"OH",Name:"Ohio",Bounds:[[38.4025,-84.819931],[42.324424,-80.51387]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"OK",Name:"Oklahoma",Bounds:[[33.615253,-103.000869],[37.00093,-94.430702]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"OR",Name:"Oregon",Bounds:[[41.992462,-124.566024],[46.285762,-116.461639]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"PA",Name:"Pennsylvania",Bounds:[[39.719429,-80.519561],[42.510452,-74.690032]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"PR",Name:"Puerto Rico",Bounds:[[17.922222,-67.938339],[18.519443,-65.241958]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"RI",Name:"Rhode Island",Bounds:[[41.144325,-71.888366],[42.0191,-71.120613]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"SC",Name:"South Carolina",Bounds:[[32.049209,-83.354354],[35.21611,-78.55368]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"SD",Name:"South Dakota",Bounds:[[42.481113,-104.057128],[45.944362,-96.436576]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"TN",Name:"Tennessee",Bounds:[[34.983898,-90.310745],[36.679244,-81.647453]],Layers:{},Applications:[],ScenariosAvailable:!1},{RegionID:"TX",Name:"Texas",Bounds:[[25.83802,-106.645782],[36.50344,-93.508743]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"UT",Name:"Utah",Bounds:[[36.99863,-114.054069],[42.004196,-109.040946]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"VT",Name:"Vermont",Bounds:[[42.727611,-73.443428],[45.016334,-71.467712]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"VA",Name:"Virginia",Bounds:[[36.539142,-83.674819],[39.466579,-75.240722]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"VI",Name:"Virgin Islands",Bounds:[[17.676666,-65.026947],[18.377777,-64.560287]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"WA",Name:"Washington",Bounds:[[45.553112,-124.75579],[49.00362,-116.912506]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"WV",Name:"West Virginia",Bounds:[[37.202762,-82.640777],[40.638553,-77.719734]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"WI",Name:"Wisconsin",Bounds:[[42.494701,-92.885391],[47.302532,-86.249565]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"WY",Name:"Wyoming",Bounds:[[40.996269,-111.055137],[45.004203,-104.051986]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"CRB",Name:"Connecticut River Basin",Bounds:[[43,-70.5],[44,-74.5]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"DRB",Name:"Delaware River Basin",Bounds:[[38.5,-73],[42.5,-77]],Layers:{},Applications:[],ScenariosAvailable:!0},{RegionID:"RRB",Name:"Rainy River Basin",Bounds:[[47.3,-89.5],[50,-96]],Layers:{},Applications:[],ScenariosAvailable:!0}];var StreamStats;!function(e){var t;!function(e){var t=function(){function e(e,t){this.RegionID=e,this.Pourpoint=t}return e}();e.StudyArea=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){var t=function(){function e(){this.append=[],this.remove=[]}return e}();e.WatershedEditDecisionList=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();var __extends=this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,a){return new r(e,t,a)}var a=function(){function e(){}return e}();e.StatisticsGroup=a;var r=function(e){function t(t,a,r){e.call(this,t,configuration.baseurls.NSS),this.$q=a,this.toaster=r,this._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,this.clearNSSdata()}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!0,configurable:!0}),t.prototype.clearNSSdata=function(){this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1},t.prototype.loadStatisticsGroupTypes=function(e,t){var a=this;if(this.toaster.pop("info","Loading Available Scenarios","Please wait...",0),e||t){var r=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),i=new WiM.Services.Helpers.RequestInfo(r,!0);this.loadingStatisticsGroup=!0,this.Execute(i).then(function(e){if(e.data.length>0){a.loadingStatisticsGroup=!1;var t=a.statisticsGroupList;angular.forEach(e.data,function(e,a){t.push(e)})}a.toaster.clear()},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",5e3)})["finally"](function(){a.loadingStatisticsGroup=!1})}},t.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},t.prototype.loadParametersByStatisticsGroup=function(e,t,a,r){var i=this;if(this.toaster.pop("info","Load Parameters by Scenario","Please wait...",0),e||t||a){var s=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup.format(e,t,a),o=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(o).then(function(e){console.log("loadParams: ",e.data[0]),e.data[0].RegressionRegions[0].Parameters&&e.data[0].RegressionRegions[0].Parameters.length>0&&i.selectedStatisticsGroupList.forEach(function(t){e.data[0].StatisticGroupName==t.Name&&(t.StatisticGroupName=t.Name,t.StatisticGroupID=t.ID,e.data[0].RegressionRegions.forEach(function(e){r.forEach(function(t){e.Name==t.name&&(e.PercentWeight=t.percent)})}),t.RegressionRegions=e.data[0].RegressionRegions,i._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))}),i.toaster.clear()},function(e){i.toaster.clear(),i.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",5e3)})["finally"](function(){})}},t.prototype.estimateFlows=function(e,t,a){var r=this;this.canUpdate=!1,this.selectedStatisticsGroupList.forEach(function(i){r.toaster.pop("info","Estimating Flows for "+i.Name,"Please wait...",0),i.RegressionRegions.forEach(function(t){t.Parameters.forEach(function(t){e.forEach(function(e){t.Code.toLowerCase()==e.code.toLowerCase()&&(t.Value=e.value)})})});var s=angular.toJson([i],null),o=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(t,i.ID,a),n=new WiM.Services.Helpers.RequestInfo(o,!0,1,"json",s);i.Results=[],i.Citations=[],r.Execute(n).then(function(e){console.log("estimate flows: ",e.data[0]);var t=e.data[0].Links[0].Href;r.getSelectedCitations(t,i);if(e.headers()["usgswim-messages"]){var a=e.headers()["usgswim-messages"].split(";");i.Disclaimers={},a.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(i.Disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(i.Disclaimers.Error=t[1].trim())}),console.log("headerMsgs: ",i.Name,i.Disclaimers)}e.data[0].RegressionRegions[0].Results&&e.data[0].RegressionRegions[0].Results.length>0?(r.toaster.clear(),i.RegressionRegions=[],i.RegressionRegions=e.data[0].RegressionRegions):(r.toaster.clear(),r.toaster.pop("error","There was an error Estimating Flows","No results were returned",5e3),console.log("Zero length flow response, check equations in NSS service"))},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error Estimating Flows","HTTP request error",5e3)})["finally"](function(){r.canUpdate=!0})})},t.prototype.getSelectedCitations=function(e,t){var a=this;this.toaster.pop("info","Requesting selected citations","Please wait...",5e3);var r=e,i=new WiM.Services.Helpers.RequestInfo(r,!0,0,"json");this.Execute(i).then(function(e){e.data[0]&&e.data[0].ID&&t.Citations.push(e.data[0])},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error getting selected Citations","Please retry",5e3)})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,a){return new i(e,t,a)}var a=function(){function e(){}return e}();e.Region=a;var r=function(){function e(){}return e}();e.Parameter=r;var i=function(e){function t(t,a,r){e.call(this,t,configuration.baseurls.StreamStats),this.$q=a,this._onSelectedRegionChanged=new WiM.Event.Delegate,this.toaster=r,this.regionList=[],this.parameterList=[],this.masterRegionList=configuration.regions,this.loadNationalMapLayers(),this.streamStatsAvailable=!1}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedRegionChanged",{get:function(){return this._onSelectedRegionChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(e){this._selectedRegion!=e&&(this._selectedRegion=e,this._onSelectedRegionChanged.raise(null,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),t.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1},t.prototype.loadRegionListByExtent=function(e,t,a,r,i){var s=this;void 0===i&&(i=4326),this.regionList.length=0;var o={f:"json",geometry:{xmin:e,ymin:a,xmax:t,ymax:r,spatialReference:{wkid:i}},tolerance:2,returnGeometry:!1,mapExtent:{xmin:e,ymin:a,xmax:t,ymax:r,spatialReference:{wkid:i}},imageDisplay:"1647, 457,96",geometryType:"esriGeometryEnvelope",sr:i,layers:"all: 4"},n=configuration.baseurls.StreamStats+configuration.queryparams.regionService,l=new WiM.Services.Helpers.RequestInfo(n,!0,0,"json");l.params=o,this.Execute(l).then(function(e){e.data.results.length<1&&s.toaster.pop("warning","No State/Regional Study Areas available here","",5e3),e.data.results.map(function(e){try{var t=s.getRegion(e.attributes.st_abbr);null!=t&&-1==s.regionList.indexOf(t)&&s.regionList.push(t)}catch(a){alert(a)}})},function(e){return s.$q.reject(e.data)})},t.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null==t?!1:(this.regionList.push(t),!0)},t.prototype.loadNationalMapLayers=function(){var e=this,t=configuration.baseurls.StreamStats+"/arcgis/rest/services/ss_studyAreas_prod/MapServer?f=pjson",a=new WiM.Services.Helpers.RequestInfo(t,!0,0,"json");this.nationalMapLayerList=[],this.Execute(a).then(function(t){t.data.layers.forEach(function(t,a){e.nationalMapLayerList.push([t.name,t.id])})},function(t){return console.log("No national map layers found"),e.$q.reject(t.data)})},t.prototype.loadMapLayersByRegion=function(e){var t=this;console.log("in loadMapLayersByRegion"),this.regionMapLayerListLoaded=!1;var a=configuration.baseurls.StreamStats+configuration.queryparams.SSStateLayers.format(e.toLowerCase()),r=new WiM.Services.Helpers.RequestInfo(a,!0,0,"json");this.regionMapLayerList=[],this.Execute(r).then(function(e){return e.data.layers?(e.data.layers.forEach(function(e,a){var r=!1;("stream grid"==e.name.toLowerCase()||"area of limited functionality"==e.name.toLowerCase())&&(r=!0),t.regionMapLayerList.push([e.name,e.id,r])}),void(t.regionMapLayerListLoaded=!0)):void t.toaster.pop("warning","No map layers available","",5e3)},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)})["finally"](function(){})},t.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),a=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(a).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(a){alert(a)}})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)})["finally"](function(){})}},t.prototype.getRegion=function(e){var t=configuration.regions;try{for(var a=0;a<t.length;a++)if(t[a].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[a].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[a];return null}catch(r){return null}},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},StreamStats;!function(e){var t;!function(t){"use strict";function a(e,t,a){return new r(e,t,a)}var r=function(t){function a(e,a,r){t.call(this,e,configuration.baseurls.StreamStats),this.$q=a,this._onSelectedStudyAreaChanged=new WiM.Event.Delegate,this._onEditClick=new WiM.Event.Delegate,this.toaster=r,this.clearStudyArea(),this.showDelineateButton=!1,this.servicesURL=configuration.baseurls.StreamStatsServices}return __extends(a,t),Object.defineProperty(a.prototype,"onSelectedStudyAreaChanged",{get:function(){return this._onSelectedStudyAreaChanged},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onEditClick",{get:function(){return this._onEditClick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),a.prototype.editBasin=function(e){this.drawControlOption=e,this._onEditClick.raise(null,WiM.Event.EventArgs.Empty)},a.prototype.undoEdit=function(){this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)},a.prototype.AddStudyArea=function(e){this.StudyAreaList.push(e),this.selectedStudyArea=e},a.prototype.RemoveStudyArea=function(){},a.prototype.clearStudyArea=function(){this._studyAreaList=[],this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoaded=!1,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.Disclaimers={},this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.showDelineateButton=!1,this.reportGenerated=!1,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1},a.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("info","Delineating Basin","Please wait...",0),this.canUpdate=!1;var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString(),!1),a=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(a).then(function(t){e.selectedStudyArea.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear()},function(t){e.toaster.clear(),e.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){e.canUpdate=!0,e._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)})},a.prototype.loadWatershed=function(t,a){var r=this;try{this.toaster.pop("info","Opening Basin","Please wait...",0);var i=new e.Models.StudyArea(t,null);this.AddStudyArea(i);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",t,a,4326,!1),o=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(o).then(function(e){r.selectedStudyArea.Features=e.data.hasOwnProperty("featurecollection")?e.data.featurecollection:null,r.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,r.selectedStudyArea.Date=new Date,r.selectedStudyArea.Features.forEach(function(e){var t=angular.fromJson(angular.toJson(e));if("globalwatershedpoint"==t.name){var a=t.feature.features[0].bbox;return void(r.selectedStudyArea.Pourpoint=new WiM.Models.Point(a[0],a[1],t.feature.crs.properties.code))}})},function(e){r.toaster.clear(),r.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){r.canUpdate=!0,r._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty),r.toaster.clear()})}catch(n){return}},a.prototype.loadEditedStudyBoundary=function(){var e=this;this.toaster.pop("info","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),a=new WiM.Services.Helpers.RequestInfo(t,!0,2,"json",this.WatershedEditDecisionList,{});this.Execute(a).then(function(t){e.clearStudyArea(),e.selectedStudyArea.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear()},function(t){e.toaster.clear(),e.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){e.canUpdate=!0,e._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)})},a.prototype.loadParameters=function(){var e=this;if(this.toaster.pop("info","Calculating Selected Parameters","Please wait...",0),this.parametersLoading=!0,this.parametersLoaded=!1,!this.selectedStudyArea||!this.selectedStudyArea.WorkspaceID||!this.selectedStudyArea.RegionID)return void alert("No Study Area");var t=[];this.studyAreaParameterList.map(function(e){t.push(e.code)});var a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,t.join(",")),r=new WiM.Services.Helpers.RequestInfo(a,!0);this.Execute(r).then(function(t){if(t.data.parameters&&t.data.parameters.length>0){var a=t.data.parameters;e.loadParameterResults(a),e.parametersLoaded=!0,e.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters)}e.toaster.clear()},function(t){e.toaster.clear(),e.toaster.pop("error","Error Calculating Basin Characteristics","Please retry",5e3)})["finally"](function(){e.parametersLoading=!1})},a.prototype.queryRegressionRegions=function(){var e=this;
this.toaster.pop("info","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var t=angular.toJson(this.selectedStudyArea.Features[1].feature,null),a=configuration.baseurls.GISserver+configuration.queryparams.RegressionRegionQueryService,r=new WiM.Services.Helpers.RequestInfo(a,!0,1,"json",{geometry:t,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(r).then(function(t){return e.toaster.clear(),e.regressionRegionQueryComplete=!0,t.data.error?void e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,5e3):0==t.data.length?void e.toaster.pop("error","Regression region query failed","This type of query may not be supported here at this time",5e3):void(t.data.length>0&&(e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)))},function(t){return console.log("Regression query failed, HTTP Error"),e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",5e3),e.$q.reject(t.data)})["finally"](function(){e.regressionRegionQueryLoading=!1})},a.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("info","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var t=angular.toJson(this.selectedStudyArea.Features[1].feature,null),a=configuration.baseurls.GISserver+configuration.queryparams.COregulationService,r=new WiM.Services.Helpers.RequestInfo(a,!0,1,"json",{watershed:t,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(r).then(function(t){t.data.percentarearegulated>0?(e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Parameters' to see area-weighted basin characteristics",5e3),e.selectedStudyArea.Features.push(t.data.featurecollection[0]),e.regulationCheckResults=t.data,e.Disclaimers.isRegulated=!0):(e.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3))},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",5e3)})["finally"](function(){e.regulationCheckComplete=!0,e._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)})},a.prototype.loadParameterResults=function(e){this.toaster.pop("info","Loading Parameters","Please wait...");var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,a){return e.code.toUpperCase().trim()===t.code.toUpperCase().trim()?void(t.value=e.value):void 0})})},a.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("info","Loading Regulated Parameters","Please wait...");var t=this.studyAreaParameterList;e.map(function(a){angular.forEach(t,function(r,i){if(a.code.toUpperCase().trim()===r.code.toUpperCase().trim()){switch(a.operation){case"Sum":r.unRegulatedValue=r.value-a.value;break;case"WeightedAverage":var s,o,n,l;angular.forEach(t,function(e,t){e.code==a.operationField&&(s=e.value)}),angular.forEach(e,function(e,t){e.code==a.operationField&&(o=e.value)}),n=a.value,l=r.value;var c=o*(n/s),u=l-c,d=s-o,p=u*(s/d);r.unRegulatedValue=p}return void(r.regulatedValue=a.value)}})})},a}(WiM.Services.HTTPServiceBase);a.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",a)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strict";function t(e){return new a(e)}var a=function(){function e(e){this.modal=e}return e.prototype.openReport=function(){console.log("in report open function");this.modal.open({templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"})},e}();t.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ReportService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,r){return new a(e,t,r)}var a=function(e){function t(t,a,r){e.call(this,t,configuration.baseurls.StreamStats),this.$q=a,this.toaster=r,this.drawElevationProfile=!1,this.drawMeasurement=!1,this.measurementData=""}return __extends(t,e),t.prototype.elevationProfile=function(e){var t=this,a="http://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",r=new WiM.Services.Helpers.RequestInfo(a,!0,1,"json",{InputLineFeatures:e,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(r).then(function(e){console.log("elevation profile response: ",e.data);var a=e.data.results[0].value.features[0].geometry.paths[0];a.length>0&&(t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a},properties:""}]})},function(e){})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){var t;!function(t){var a=function(){function e(){this.lat=0,this.lng=0}return e}(),r=function(){function e(e,t,a){this.lat=e,this.lng=t,this.zoom=a}return e}(),i=function(){function e(e,t,a,r,i){void 0===i&&(i=void 0),this.name=e,this.url=t,this.type=a,this.visible=r,this.layerOptions=i}return e}(),s=function(){function e(e,t,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===a&&(a=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=a}return e}(),o=function(){function t(e,t,a,r,i,s,o,n,l,c,u,d){var p=this;this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,e.vm=this,this.init(),this.toaster=t,this.angulartics=a,this.searchService=n,this.$locationService=r,this.regionServices=l,this.leafletBoundsHelperService=s,this.leafletData=o,this.studyArea=c,this.nssService=u,this.explorationService=d,n.onSelectedAreaOfInterestChanged.subscribe(this._onSelectedAreaOfInterestHandler),l.onSelectedRegionChanged.subscribe(this._onSelectedRegionHandler),c.onSelectedStudyAreaChanged.subscribe(this._onSelectedStudyAreaHandler),c.onEditClick.subscribe(this._onEditClickHandler),e.$on("leafletDirectiveMap.mousemove",function(e,t){var a=t.leafletEvent.latlng;p.mapPoint.lat=a.lat,p.mapPoint.lng=a.lng}),e.$on("leafletDirectiveMap.drag",function(e,t){p.cursorStyle="grabbing"}),e.$on("leafletDirectiveMap.dragend",function(e,t){p.cursorStyle="pointer"}),e.$on("leafletDirectiveMap.click",function(e,t){c.doDelineateFlag?p.checkDelineatePoint(t.leafletEvent.latlng):l.selectedRegion||p.explorationService.drawElevationProfile||p.explorationService.drawMeasurement?l.selectedRegion&&p.regionServices.allowStreamgageQuery&&!p.explorationService.drawElevationProfile&&!p.explorationService.drawMeasurement&&p.queryStreamgages(t.leafletEvent):p.queryNationalMapLayers(t.leafletEvent)}),e.$watch(function(){return p.bounds},function(e,t){return p.mapBoundsChange(t,e)}),e.$watch(function(){return p.explorationService.elevationProfileGeoJSON},function(e,t){e&&p.displayElevationProfile()}),e.$watch(function(){return p.explorationService.drawElevationProfile},function(e,t){e&&p.elevationProfile()}),e.$watch(function(){return p.explorationService.drawMeasurement},function(e,t){console.log("measurementListener ",e,t),e&&p.measurement()}),e.$watch(function(){return p.regionServices.regionMapLayerListLoaded},function(e,t){e&&(console.log("in regionMapLayerListLoaded watch: ",p.regionServices.selectedRegion),p.addRegionOverlayLayers(p.regionServices.selectedRegion.RegionID))}),e.$on("$locationChangeStart",function(){return p.updateRegion()}),e.$watch(function(){return c.doDelineateFlag},function(e,t){return e?p.cursorStyle="crosshair":p.cursorStyle="pointer"}),i.rcode&&(this.regionServices.loadParametersByRegion(),this.setBoundsByRegion(i.rcode)),i.rcode&&i.workspaceID&&(this.regionServices.loadParametersByRegion(),this.studyArea.loadWatershed(i.rcode,i.workspaceID)),e.$watch(function(){return p.studyArea.regressionRegionQueryComplete},function(e,t){e&&p.studyArea.selectedStudyArea.RegressionRegions&&p.nssService.loadStatisticsGroupTypes(p.regionServices.selectedRegion.RegionID,p.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))})}return t.prototype.init=function(){var e=this;this._onSelectedAreaOfInterestHandler=new WiM.Event.EventHandler(function(t,a){e.onSelectedAreaOfInterestChanged(t,a)}),this._onSelectedRegionHandler=new WiM.Event.EventHandler(function(){e.onSelectedRegionChanged()}),this._onSelectedStudyAreaHandler=new WiM.Event.EventHandler(function(){e.onSelectedStudyAreaChanged()}),this._onEditClickHandler=new WiM.Event.EventHandler(function(){e.basinEditor()}),this.center=new r(39,-100,3),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers,markers:this.markers,geojson:this.geojson},this.mapDefaults=new s(null,3,!0),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new a,L.Icon.Default.imagePath="images"},t.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},t.prototype.queryNationalMapLayers=function(e){var t=this;this.toaster.pop("info","Information","Querying National map layers...",0),this.cursorStyle="wait",this.angulartics.eventTrack("initialOperation",{category:"Map",label:"Map click query"}),this.leafletData.getMap().then(function(a){t.leafletData.getLayers().then(function(r){r.overlays.SSLayer.identify().on(a).at(e.latlng).returnGeometry(!1).run(function(r,i){if(i.features.length<1)return t.cursorStyle="pointer",t.toaster.clear(),t.toaster.pop("warning","Warning","No State/Regional Study Found",0),void a.panBy([0,1]);var s=[];i.features.forEach(function(e){t.regionServices.nationalMapLayerList.forEach(function(t){e.layerId==t[1]&&("State Applications"==t[0]||"Regional Studies"==t[0])&&a.getZoom()<=7&&("State Applications"==t[0]&&s.push(e.properties.ST_ABBR),"Regional Studies"==t[0]&&s.push(e.properties.st_abbr))})}),console.log("bounds",a.getBounds()),s.length<1||(1==s.length&&t.regionServices.masterRegionList.forEach(function(e){e.RegionID==s[0]&&(t.setBoundsByRegion(s[0]),console.log("in map click query",t.regionServices.selectedRegion),t.regionServices.selectedRegion&&t.regionServices.loadParametersByRegion())}),s.length>1&&a.setView(e.latlng,9),t.toaster.clear(),t.cursorStyle="pointer")})})})},t.prototype.queryStreamgages=function(e){var t=this;this.toaster.pop("info","Information","Querying Streamgages...",0),this.cursorStyle="wait",this.markers={},this.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryStreamgages"}),this.leafletData.getMap().then(function(a){t.leafletData.getLayers().then(function(r){r.overlays.SSLayer.identify().on(a).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(r,i){t.toaster.clear(),i.features&&(i.features.forEach(function(r){t.regionServices.regionMapLayerList.forEach(function(i){if(r.layerId==i[1]&&"streamgages"==i[0].toLowerCase()){var s="",o=["latitude","longitude","sta_id","sta_name","featureurl","drnarea"];angular.forEach(r.properties,function(e,t){if(-1!=o.indexOf(t))if("featureurl"==t){var a=e.split("site_no=")[1],r="http://streamstatsags.cr.usgs.gov/gagepages/html/"+a+".htm";s+='<strong>NWIS page: </strong><a href="'+e+' "target="_blank">link</a></br><strong>StreamStats Gage page: </strong><a href="'+r+'" target="_blank">link</a></br>'}else s+="<strong>"+t+": </strong>"+e+"</br>"}),t.markers.regionalQueryResult={lat:e.latlng.lat,lng:e.latlng.lng,message:s,focus:!0,draggable:!1},a.panBy([0,1]),t.toaster.clear()}})}),t.cursorStyle="pointer")})})})},t.prototype.elevationProfile=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="";var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(t=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap().then(function(a){e.leafletData.getLayers().then(function(r){var i=r.overlays.draw;i.clearLayers();var s=new L.Draw.Polyline(a,{metric:!1});s.enable(),e.geojson={},a.on("draw:drawstart",function(e){t.clear()}),a.on("draw:created",function(t){a.removeEventListener("draw:created");var r=t.layer.toGeoJSON(),i='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(r.geometry.coordinates)+"]}}]}";e.cursorStyle="wait",e.toaster.pop("info","Information","Querying the elevation service...",0),e.explorationService.elevationProfile(i),e.explorationService.drawElevationProfile=!1,a.panBy([0,1])})})})},t.prototype.displayElevationProfile=function(){var e;this.controls.custom.forEach(function(t){t._container&&t._container.className.indexOf("elevation")>-1&&(e=t)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:e.addData.bind(e)},this.leafletData.getMap().then(function(t){var a=e.onAdd(t);document.getElementById("elevation-div").innerHTML="",document.getElementById("elevation-div").appendChild(a)}),this.toaster.clear(),this.cursorStyle="pointer"},t.prototype.showLocation=function(){var e;this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start()},t.prototype.resetMap=function(){this.regionServices.clearRegion(),this.studyArea.clearStudyArea(),this.nssService.clearNSSdata(),this.center=new r(39,-100,3)},t.prototype.measurement=function(){var e=this;document.getElementById("elevation-div").innerHTML="",this.explorationService.measurementData="Click the map to begin",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap().then(function(t){e.leafletData.getLayers().then(function(a){var r=!1,i=new L.Draw.Polyline(t,{shapeOptions:{color:"blue"},metric:!1});i.enable();var s=a.overlays.draw;s.clearLayers();var o=function(){e.explorationService.measurementData="Total length: "+i._getMeasurementString()},n=function(){0==r&&(r=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",o))},l=function(a){var r=a.layer;s.addLayer(r),s.addTo(t),e.explorationService.measurementData="Total length: "+i._getMeasurementString(),t.off("click",n),t.off("mousemove",o),t.off("draw:created",l),i.disable(),e.explorationService.drawMeasurement=!1};t.on("click",n),t.on("draw:created",l)})})},t.prototype.checkDelineatePoint=function(e){var t=this;this.studyArea.checkingDelineatedPoint=!0,this.toaster.pop("info","Information","Validating your clicked point...",5e3),this.cursorStyle="wait",this.markers={},this.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!1},this.studyArea.doDelineateFlag=!1;var a="visible:";this.regionServices.regionMapLayerList.forEach(function(e){("area of limited functionality"==e[0].toLowerCase()||"areas of limited functionality"==e[0].toLowerCase())&&(a+=String(e[1]))}),this.leafletData.getMap().then(function(r){t.leafletData.getLayers().then(function(i){t.angulartics.eventTrack("delineationClick",{category:"Map",label:t.regionServices.selectedRegion.Name}),r.invalidateSize();var s=t.regionServices.selectedRegion.RegionID+"_region";i.overlays[s].identify().on(r).at(e).returnGeometry(!1).layers(a).run(function(a,r){if(0==r.features.length)t.angulartics.eventTrack("validatePoint",{category:"Map",label:"valid"}),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),t.studyArea.checkingDelineatedPoint=!1,t.startDelineate(e);else{t.studyArea.Disclaimers.isInExclusionArea=!0,t.studyArea.checkingDelineatedPoint=!1;var i=r.features[0].properties.ExcludeCode,s=r.features[0].properties.ExcludeReason;1==i?(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",s,0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not allowed"})):(t.toaster.pop("warning","Delineation and flow statistic computation possible but not advised",s,!0,0),t.startDelineate(e),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised"}))}t.cursorStyle="pointer"})})})},t.prototype.basinEditor=function(){var e=this;if(this.layers.overlays.globalwatershed.data.features.length>1)return void this.toaster.pop("warning","Warning","You cannot edit a global watershed",5e3);var t=angular.fromJson(angular.toJson(this.layers.overlays.globalwatershed)),a=[];t.data.features[0].geometry.coordinates[0].forEach(function(e){a.push([e[1],e[0]])}),this.leafletData.getMap().then(function(r){e.leafletData.getLayers().then(function(i){var s=i.overlays.draw;s.clearLayers();var o=new L.Draw.Polygon(r,s);o.enable(),r.on("draw:created",function(i){r.removeEventListener("draw:created");var o=i.layer;s.addLayer(o),e.studyArea.Disclaimers.isEdited=!0;var n=o.toGeoJSON().geometry.coordinates[0],l=[];n.forEach(function(e){l.push([e[1],e[0]])});var c=L.polygon(a),u=L.polygon(l);if("add"==e.studyArea.drawControlOption){var d=greinerHormann.union(c,u);e.studyArea.WatershedEditDecisionList.append.push(o.toGeoJSON()),e.angulartics.eventTrack("basinEditor",{category:"Map",label:"addArea"})}if("remove"==e.studyArea.drawControlOption){var d=greinerHormann.diff(c,u);if(2==d.length)return alert("Splitting polygons is not permitted"),void s.clearLayers();e.studyArea.WatershedEditDecisionList.remove.push(o.toGeoJSON()),e.angulartics.eventTrack("basinEditor",{category:"Map",label:"removeArea"})}t.data.features[0].geometry.coordinates[0]=[],d.forEach(function(e){t.data.features[0].geometry.coordinates[0].push([e[1],e[0]])}),e.toaster.pop("info","Submitting your edit","Please wait...",5e3),e.removeOverlayLayers("globalwatershed",!1),s.clearLayers(),setTimeout(function(){e.layers.overlays.globalwatershed={name:'<img src=images/regulated-basin.png height="16">&nbsp;&nbsp;Edited Basin Boundary',type:"geoJSONShape",data:t.data,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}},100)})})})},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.markers={};var a=t.selectedAreaOfInterest;if("U.S. State or Territory"==a.Category)var r=9;else var r=14;this.markers.AOI={lat:a.Latitude,lng:a.Longitude,message:a.Name,focus:!0,draggable:!1},this.leafletData.getMap().then(function(e){e.setView([a.Latitude,a.Longitude],r)})},t.prototype.onSelectedRegionChanged=function(){console.log("in onselected region changed",this.regionServices.regionList,this.regionServices.selectedRegion),this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},t.prototype.onSelectedStudyAreaChanged=function(){var e=this;if(this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.Features){var t=this.studyArea.selectedStudyArea.Pourpoint.Latitude,a=this.studyArea.selectedStudyArea.Pourpoint.Longitude,r=this.studyArea.selectedStudyArea.RegionID,i=this.studyArea.selectedStudyArea.WorkspaceID;this.studyArea.selectedStudyArea.Features.forEach(function(s){var o=angular.fromJson(angular.toJson(s));"globalwatershed"==o.name&&(e.layers.overlays[o.name]={name:'<img src=images/basin.png height="16">&nbsp;&nbsp;Basin Boundary',type:"geoJSONShape",data:o.feature,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}),"globalwatershedpoint"==o.name&&(e.layers.overlays[o.name]={name:'<img src=images/marker-icon.png height="16">&nbsp;&nbsp;Basin Clicked Point',type:"geoJSONShape",data:o.feature,visible:!0,layerOptions:{onEachFeature:function(e,s){var o="<strong>Latitude: </strong>"+t+"</br><strong>Longitude: </strong>"+a+"</br><strong>Region: </strong>"+r+"</br><strong>WorkspaceID: </strong>"+i+"</br>";angular.forEach(e.properties,function(e,t){o+="<strong>"+t+": </strong>"+e+"</br>"}),s.bindPopup(o)}}}),"regulatedWatershed"==o.name&&(e.layers.overlays.globalwatershedregulated={name:'<img src=images/regulated-basin.png height="16">&nbsp;&nbsp;Basin Boundary (Regulated Area)',type:"geoJSONShape",data:o.feature,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}})}),this.markers={};var s=this.layers.overlays.globalwatershed.data.features[0].bbox;if(this.leafletData.getMap().then(function(e){e.fitBounds([[s[1],s[0]],[s[3],s[2]]],{})}),!this.nssService.queriedRegions){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0,this.studyArea.queryRegressionRegions()}}},t.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=9&&e!==t&&this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.center.zoom>=15?this.studyArea.showDelineateButton=!0:this.studyArea.showDelineateButton=!1},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(console.log("in setBoundsByRegion selectedRegion gets set here"),this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},t.prototype.addRegionOverlayLayers=function(e){var t=this;if(!(this.regionServices.regionMapLayerList.length<1)){this.layers.overlays[e+"_region"]=new i(e+" Map layers",configuration.baseurls.StreamStats+"/arcgis/rest/services/{0}_ss/MapServer".format(e.toLowerCase()),"agsDynamic",!0,{opacity:1,format:"png8",f:"image"}),this.leafletData.getLayers().then(function(a){var r=a.overlays[e+"_region"],i=[];t.regionServices.regionMapLayerList.forEach(function(e){e[2]&&i.push(e[1])}),console.log("visible state/region map layers: ",i),r.setLayers([i])});var a=this.regionServices.selectedRegion.Layers;if(void 0!=a)for(var r in a)this.layers.overlays[r+"_region"]=a[r]}},t.prototype.removeOverlayLayers=function(e,t){var a=this;void 0===t&&(t=!1);var r;r=this.getLayerIdsByID(e,this.layers.overlays,t),r.forEach(function(e){delete a.layers.overlays[e]})},t.prototype.getLayerIdsByName=function(e,t,a){var r=[];for(var i in t)t[i].hasOwnProperty("name")&&(a?t[i].name.indexOf(e)>-1:t[i].name===e)&&r.push(i);return r},t.prototype.getLayerIdsByID=function(e,t,a){var r=[];for(var i in t)(a?i.indexOf(e)>-1:i===e)&&r.push(i);return r},t.prototype.startDelineate=function(t){var a=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(a),this.studyArea.loadStudyBoundary()},t.$inject=["$scope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",o)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t,a=function(){function e(e,t,a,r,i,s,o,n,l,c){var u=this;e.vm=this,this.init(),this.toaster=t,this.angulartics=a,this.searchService=r,this.sideBarCollapsed=!1,this.selectedProcedure=1,this.regionService=i,this.nssService=o,this.studyAreaService=s,this.reportService=n,this.leafletData=l,this.multipleParameterSelectorAdd=!0,this.explorationService=c,o.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),e.$watch(function(){return u.regionService.selectedRegion},function(e,t){null==e?u.setProcedureType(1):u.setProcedureType(2)}),e.$watch(function(){return u.studyAreaService.parametersLoaded},function(e,t){e!=t&&(null==e?u.setProcedureType(3):u.setProcedureType(4))})}return e.prototype.getLocations=function(e){return this.searchService.getLocations(e)},e.prototype.setProcedureType=function(e){return this.selectedProcedure!=e&&this.canUpdateProcedure(e)?void(this.selectedProcedure=e):(3==this.selectedProcedure&&4==e&&this.toaster.pop("warning","Warning","Make sure you calculate selected basin characteristics before continuing",5e3),void(2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3)))},e.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},e.prototype.onAOISelect=function(e){this.searchService.onSelectedAreaOfInterestChanged.raise(this,new WiM.Services.SearchAPIEventArgs(e))},e.prototype.zoomRegion=function(e){angular.fromJson(e)},e.prototype.setRegion=function(e){this.angulartics.eventTrack("initialOperation",{category:"SideBar",label:"Region Selection Button"}),(void 0==this.regionService.selectedRegion||this.regionService.selectedRegion.RegionID!==e.RegionID)&&(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},e.prototype.resetWorkSpace=function(){this.studyAreaService.clearStudyArea(),this.nssService.clearNSSdata()},e.prototype.startDelineate=function(){var e=this;this.leafletData.getMap().then(function(t){return t.getZoom()<15?void e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate."):(e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),void(e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag))})},e.prototype.setStatisticsGroup=function(e){var t=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,e);console.log("set stat group: ",t),-1!=t?this.nssService.selectedStatisticsGroupList.splice(t,1):(this.nssService.selectedStatisticsGroupList.push(e),this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,e.ID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions))},e.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},e.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var a=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==a&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):a>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(a,1),e.toaster.pop("warning",t.code+" is required by one of the selected scenarios","It cannot be unselected"),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},e.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e);t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):this.studyAreaService.studyAreaParameterList.push(e)},e.prototype.calculateParameters=function(){this.angulartics.eventTrack("CalculateParameters",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters()},e.prototype.submitBasinEdits=function(){this.studyAreaService.showEditToolbar=!1,this.studyAreaService.Disclaimers.isEdited&&this.studyAreaService.loadEditedStudyBoundary()},e.prototype.selectScenarios=function(){this.setProcedureType(3)},e.prototype.generateReport=function(){this.angulartics.eventTrack("CalculateFlows",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.nssService.selectedStatisticsGroupList.map(function(e){return e.Name}).join(",")}),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable&&this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(",")),this.reportService.openReport(),this.studyAreaService.reportGenerated=!0},e.prototype.checkRegulation=function(){this.studyAreaService.upstreamRegulation()},e.prototype.queryRegressionRegions=function(){return this.regionService.selectedRegion.ScenariosAvailable?(this.nssService.queriedRegions=!0,void this.studyAreaService.queryRegressionRegions()):void(this.studyAreaService.regressionRegionQueryComplete=!0)},e.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.regionService.parameterList.forEach(function(t){e.nssService.selectedStatisticsGroupList.forEach(function(a){a.RegressionRegions&&a.RegressionRegions.forEach(function(a){a.Parameters.forEach(function(a){t.code.toLowerCase()==a.Code.toLowerCase()&&(-1==e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t)&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0,t.toggleable=!1)})})})})},e.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},e.prototype.canUpdateProcedure=function(e){try{switch(e){case 1:return!0;case 2:return null!=this.regionService.selectedRegion;case 3:return this.studyAreaService.regressionRegionQueryComplete;case 4:return this.studyAreaService.parametersLoaded;default:return!1}}catch(t){return!1}},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope","toaster","$analytics","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ReportService","leafletData","StreamStats.Services.ExplorationService"],e}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",a);
}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,a){e.vm=this,this.reportService=t}return e.prototype.openReport=function(){this.reportService.openReport()},e.$inject=["$scope","StreamStats.Services.ReportService","StreamStats.Services.StudyAreaService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t=function(){function e(e,t,a){this.lat=e,this.lng=t,this.zoom=a}return e}(),a=function(){function e(e,t,a,r,i,s){var o=this;this.markers=null,this.overlays=null,this.center=null,this.layers=null,e.vm=this,this.angulartics=t,this.studyAreaService=r,this.nssService=i,this.leafletData=s,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.initMap(),e.$on("leafletDirectiveMap.load",function(e,t){console.log("report map load"),o.showFeatures()}),this.close=function(){a.dismiss("cancel")},this.print=function(){window.print()}}return e.prototype.initMap=function(){this.center=new t(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},L.Icon.Default.imagePath="images"},e.prototype.showFeatures=function(){var e=this;this.studyAreaService.selectedStudyArea&&(this.overlays={},this.studyAreaService.selectedStudyArea.Features.forEach(function(t){if(console.log("in each loop",t.name),"globalwatershed"==t.name){e.layers.overlays[t.name]={name:"Basin Boundary",type:"geoJSONShape",data:t.feature,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}};var a=e.layers.overlays[t.name].data.features[0].bbox;e.leafletData.getMap().then(function(e){e.invalidateSize(),console.log("in getmap: ",a),e.fitBounds([[a[1],a[0]],[a[3],a[2]]]),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.boxZoom.disable(),e.keyboard.disable(),e.tap&&e.tap.disable()})}"globalwatershedpoint"==t.name&&(e.layers.overlays[t.name]={name:"Basin Clicked Point",type:"geoJSONShape",data:t.feature,visible:!0}),"regulatedWatershed"==t.name&&(console.log("showing regulated watershed"),e.layers.overlays.globalwatershedregulated={name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t.feature,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}})}))},e.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t="data.csv",a=function(t){var a="\n\nParameters\n";return a+=e.studyAreaService.Disclaimers.isRegulated?"Name,Value,Reglated Value, Unregulated Value, Unit\n":"Name,Value,Unit\n",t.forEach(function(t){a+=e.studyAreaService.Disclaimers.isRegulated?t.name+","+t.value+","+t.unRegulatedValue.toFixed(2)+","+t.regulatedValue.toFixed(2)+","+t.unit+"\n":t.name+","+t.value+","+t.unit+"\n"}),a+"\n"},r=function(e){var t="";return e.RegressionRegions.forEach(function(a){t+=e.Name+" Parameters "+a.PercentWeight.toFixed(0)+" Percent  "+a.Name.split("_").join(" ")+"\n",t+="Name,Value,Min Limit, Max Limit\n",a.Parameters.forEach(function(e){t+=e.Name+","+e.Value+","+e.Limits.Min.toFixed(2)+","+e.Limits.Max.toFixed(2)+"\n"})}),t+"\n"},i=function(e){var t=e.Name+" Flow Report\n";return t+="Name,Value,Unit,Prediction Error\n",e.Results.forEach(function(e){t+=e.Name+","+e.Value.toFixed(0)+","+e.Unit.Abbr+",\n"}),t+"\n"},s="State/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString();s+=a(this.studyAreaService.studyAreaParameterList),this.nssService.selectedStatisticsGroupList.forEach(function(e){s+=r(e),s+=i(e)});var o=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,t);else{var n=document.createElement("a"),l=URL.createObjectURL(o);void 0!==n.download?(n.setAttribute("href",l),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(l)}},e.$inject=["$scope","$analytics","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",a)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},WiM;!function(e){var t;!function(t){"use string";var a=function(t){function a(e,a,r,i,s,o){t.call(this,a,""),e.vm=this,this.leafletData=s,this.leafletHelpers=o,this.init()}return __extends(a,t),a.prototype.initOverlays=function(t){if("agsDynamic"==t.type){var a=t.url+"/legend?f=pjson",r=new e.Services.Helpers.RequestInfo(a,!0);this.Execute(r).then(function(e){console.log(e.data),e.data.layers.length>0&&(t.isOpen=!0,t.layerArray=e.data.layers)},function(e){})}},a.prototype.changeBaseLayer=function(e,t){var a=this;this.baselayers.selectedlayerName=e.toString(),this.leafletData.getMap().then(function(t){a.leafletData.getLayers().then(function(a){if(!t.hasLayer(a.baselayers[e])){for(var r in a.baselayers)t.hasLayer(a.baselayers[r])&&t.removeLayer(a.baselayers[r]);t.addLayer(a.baselayers[e])}})}),t.preventDefault()},a.prototype.init=function(){var e=this;this.overlays={},this.baselayers={},this.overlays.isOpen=!1,this.baselayers.isOpen=!0,this.leafletData.getMap().then(function(t){e.leafletData.getLayers().then(function(a){for(var r in a.baselayers)if(t.hasLayer(a.baselayers[r])){e.baselayers.selectedlayerName=r.toString();break}})})},a.$inject=["$scope","$http","$element","$sce","leafletData","leafletHelpers"],a}(e.Services.HTTPServiceBase),r=function(){function e(){this.scope={icons:"=?",autoHideOpacity:"=?",showGroups:"=?",title:"@",baseTitle:"@",overlaysTitle:"@"},this.restrict="E",this.require="^leaflet",this.transclude=!1,this.controller=a,this.templateUrl="Views/Legend/legend.html",this.replace=!0}return e.instance=function(){return new e},e.prototype.link=function(e,t,a,r){var i=r.getLeafletScope(),s=i.layers;e.vm.overlays.layergroup=s.overlays,e.vm.baselayers.layergroup=s.baselayers,e.vm.layers=s,t.bind("click",function(e){e.stopPropagation(),e.preventDefault()}),t.bind("mouseover",function(e){r.getMap().then(function(e){e.dragging.disable()})}),t.bind("mouseout",function(e){r.getMap().then(function(e){e.dragging.enable()})})},e}();angular.module("wim_angular").directive("wimLegend",r.instance)}(t=e.Directives||(e.Directives={}))}(WiM||(WiM={}));