var StreamStats;!function(e){var t=function(){function e(e,t,r){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$stateProvider.state("main",{url:"/?region",reloadOnSearch:!0,template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","mobile-angular-ui","toaster","ngAnimate","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","wim_angular"]).config(t)}(StreamStats||(StreamStats={}));var configuration={};configuration.baseurls={MercuryService:"http://54.174.81.42/mercuryservices",MercuryAuth:"http://54.174.81.42/mercuryauth",RegressionService:"http://commons.wim.usgs.gov/regressionservice/models",KrigService:"http://commons.wim.usgs.gov/krigservice",NWISurl:"http://waterservices.usgs.gov/nwis",StreamStats:"http://streamstats09.cr.usgs.gov",StreamStatsServices:"http://streamstatsags.cr.usgs.gov",NSS:"http://commons.wim.usgs.gov/nssservices",SearchAPI:"http://txpub.usgs.gov/DSS/search_api/1.0/dataService/dataService.ashx",FARefGage:"http://wim.usgs.gov/arcgis/rest/services/CedarRiverMapper/IowaFlowAnywhere/MapServer",RegulationServices:"http://54.164.188.167:6080"},configuration.queryparams={NWISsite:"/site/?format=mapper,1.0&stateCd={0}&siteType=GL,OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS&hasDataTypeCd=iv",KrigService:"/krig?state={0}&xlocation={1}&ylocation={2}&sr={3}",RegressionScenarios:"/{0}/estimate?state={1}",statisticsGroupLookup:"/statisticgroups.json?region={0}&regressionregions={1}",statisticsGroupParameterLookup:"/scenarios.json?region={0}&statisticgroups={1}&regressionregions={2}",estimateFlows:"/scenarios/estimate.json?region={0}&statisticgroups={1}&regressionregions={2}",SSdelineation:"/streamstatsservices/watershed.{0}?rcode={1}&xlocation={2}&ylocation={3}&crs={4}&simplify=true&includeparameters=false&includeflowtypes=false&includefeatures=true",SSAvailableParams:"/streamstatsservices/parameters.json?rcode={0}&group={1}",SSComputeParams:"/streamstatsservices/parameters.json?rcode={0}&workspaceID={1}&includeparameters={2}",SSStateLayers:"/arcgis/rest/services/{0}_ss/MapServer?f=pjson",FARefGage:"/2/query?geometry={0}&geometryType=esriGeometryPoint&inSR={1}&spatialRel=esriSpatialRelIntersects&outFields=regions_local.Region_Agg,reference_gages.site_id,reference_gages.site_name,reference_gages.da_gis_mi2,reference_gages.lat_dd_nad,reference_gages.long_dd_na&returnGeometry=false&returnIdsOnly=false&returnCountOnly=false&returnZ=false&returnM=false&returnDistinctValues=false&f=pjson",regionService:"/arcgis/rest/services/ss_studyAreas_prod/MapServer/identify",COregulationService:"/arcgis/rest/services/Regulation/CORegulationSites/MapServer/exts/RegulationRESTSOE/Regulation"},configuration.basemaps={gray:{name:"ESRI Gray",type:"agsBase",layer:"Gray",visible:!0},tnmBaseMap:{name:"USGS National Map",visible:!1,type:"group",layerOptions:{layers:[{name:"tiles",url:"http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}",type:"xyz",layerOptions:{minZoom:0,maxZoom:15,attribution:"<a href='http://www.doi.gov'>U.S. Department of the Interior</a> | <a href='http://www.usgs.gov'>U.S. Geological Survey</a> | <a href='http://www.usgs.gov/laws/policies_notices.html'>Policies</a>"}},{name:"dynamic",url:"http://services.nationalmap.gov/arcgis/rest/services/USGSTopoLarge/MapServer",type:"agsDynamic",layerOptions:{minZoom:16,maxZoom:20,attribution:"<a href='http://www.doi.gov'>U.S. Department of the Interior</a> | <a href='http://www.usgs.gov'>U.S. Geological Survey</a> | <a href='http://www.usgs.gov/laws/policies_notices.html'>Policies</a>"}}]}},MapquestOAM:{name:"Mapquest Areal",url:"http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",visible:!1,type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}},MapquestHYB:{name:"Mapquest Hybrid",type:"group",visible:!1,layerOptions:{maxZoom:19,layers:[{name:"tiles",url:"http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"]}},{name:"roads",url:"http://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}}]}},mapquestOSM:{name:"Mapquest Streets",url:"http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",visible:!1,type:"xyz",layerOptions:{maxZoom:19,subdomains:["otile1","otile2","otile3","otile4"],attribution:"Tiles courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>. Map data (c) <a href='http://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a> contributors, CC-BY-SA."}}},configuration.overlayedLayers={str900co_utm:{name:"str900 (co) utm",url:"http://54.164.188.167:6080/arcgis/rest/services/streamstats/str900_co/ImageServer",type:"agsImage",visible:!0,layerOptions:{minZoom:15,maxZoom:17,opacity:.5,renderingRule:{rasterFunction:"Colormap",rasterFunctionArguments:{Colormap:[[1,0,0,255]]},variableName:"Value"}}},SSLayer:{name:"Implementated Regions",url:configuration.baseurls.StreamStats+"/arcgis/rest/services/ss_studyAreas_prod/MapServer",type:"agsDynamic",visible:!0,layerOptions:{opacity:.6,style:function(e){return{color:"gray",weight:2}}}}},configuration.customMapServices={IA:{FLA:{name:"Flow Anywhere Model",url:"http://wim.usgs.gov/arcgis/rest/services/CedarRiverMapper/IowaFlowAnywhere/MapServer",type:"agsDynamic",visible:!0,layerOptions:{opacity:.5}},FDCTM:{name:"Flow Duration Curve Transfer Model",url:"http://wim.usgs.gov/arcgis/rest/services/CedarRiverMapper/IowaFlowDuration2/MapServer",type:"agsDynamic",visible:!0,layerOptions:{opacity:.5}},PRMS:{name:"PRMS",url:"http://wim.usgs.gov/arcgis/rest/services/IowaPRMSMapper/IOWA_PRMS/MapServer",type:"agsDynamic",visible:!1,layerOptions:{opacity:.5}}}},configuration.regions=[{RegionID:"AL",Name:"Alabama",Bounds:[[30.189622,-88.47203],[35.00888,-84.893486]]},{RegionID:"AK",Name:"Alaska",Bounds:[[51,-179],[72,-140]]},{RegionID:"AS",Name:"American Samoa",Bounds:[[-14.375555,-170.82611],[-14.166389,-169.438323]]},{RegionID:"AZ",Name:"Arizona",Bounds:[[31.329174,-114.815414],[37.004585,-109.044883]]},{RegionID:"AR",Name:"Arkansas",Bounds:[[33.004528,-94.618156],[36.499656,-89.644409]]},{RegionID:"CA",Name:"California",Bounds:[[32.530426,-124.411186],[42.009826,-114.129486]]},{RegionID:"CO",Name:"Colorado",Bounds:[[36.992225,-109.060806],[41.005611,-102.041984]]},{RegionID:"CT",Name:"Connecticut",Bounds:[[40.982486,-73.729721],[42.049732,-71.788238]]},{RegionID:"DE",Name:"Delaware",Bounds:[[38.449325,-75.788055],[39.840576,-75.042396]]},{RegionID:"DC",Name:"District of Columbia",Bounds:[[38.801475,-77.120506],[38.995063,-76.909698]]},{RegionID:"FL",Name:"Florida",Bounds:[[24.518321,-87.637229],[31.002105,-80.029022]]},{RegionID:"GA",Name:"Georgia",Bounds:[[30.35713,-85.605514],[35.002037,-80.841957]]},{RegionID:"GU",Name:"Guam",Bounds:[[13.234996,144.634155],[13.65361,144.953308]]},{RegionID:"HA",Name:"Hawaii",Bounds:[[18.915493,-160.236068],[22.234394,-154.798583]]},{RegionID:"ID",Name:"Idaho",Bounds:[[41.989837,-117.240196],[49.001522,-111.043617]]},{RegionID:"IL",Name:"Illinois",Bounds:[[36.971115,-91.512626],[42.509479,-87.018081]]},{RegionID:"IN",Name:"Indiana",Bounds:[[37.773048,-88.089744],[41.762321,-84.787673]]},{RegionID:"IA",Name:"Iowa",Bounds:[[40.374542,-96.635665],[43.504646,-90.139312]]},{RegionID:"KS",Name:"Kansas",Bounds:[[36.992221,-102.048553],[40.004512,-94.592735]]},{RegionID:"KY",Name:"Kentucky",Bounds:[[36.496719,-89.573677],[39.147232,-81.964202]]},{RegionID:"LA",Name:"Louisiana",Bounds:[[28.918104,-94.045776],[33.020599,-88.814056]]},{RegionID:"ME",Name:"Maine",Bounds:[[43.064773,-71.082],[47.461883,-66.954002]]},{RegionID:"MD",Name:"Maryland",Bounds:[[37.911422,-79.487152],[39.724014,-75.045898]]},{RegionID:"MA",Name:"Massachusetts",Bounds:[[41.237003,-73.508407],[42.886661,-69.925399]]},{RegionID:"MI",Name:"Michigan",Bounds:[[41.6958,-90.418708],[48.304248,-82.122901]]},{RegionID:"MN",Name:"Minnesota",Bounds:[[43.502101,-97.238975],[49.38562,-89.487754]]},{RegionID:"MS",Name:"Mississippi",Bounds:[[30.174402,-91.654251],[34.998321,-88.097961]]},{RegionID:"MO",Name:"Missouri",Bounds:[[35.99509,-95.774414],[40.614028,-89.100593]]},{RegionID:"MT",Name:"Montana",Bounds:[[44.357688,-116.050735],[49.001808,-104.03971]]},{RegionID:"NE",Name:"Nebraska",Bounds:[[39.999885,-104.052841],[43.002796,-95.307998]]},{RegionID:"NV",Name:"Nevada",Bounds:[[35.002079,-120.005348],[42.000312,-114.039344]]},{RegionID:"NH",Name:"New Hampshire",Bounds:[[42.697776,-72.556434],[45.308731,-70.7135]]},{RegionID:"NJ",Name:"New Jersey",Bounds:[[38.92564,-75.567596],[41.357639,-73.89363]]},{RegionID:"NM",Name:"New Mexico",Bounds:[[31.331899,-109.050102],[36.999423,-103.000656]]},{RegionID:"NY",Name:"New York",Bounds:[[40.499076,-79.763328],[45.017364,-71.85588]]},{RegionID:"NC",Name:"North Carolina",Bounds:[[33.844467,-84.320968],[36.589008,-75.459503]]},{RegionID:"ND",Name:"North Dakota",Bounds:[[45.93505,-104.049591],[49.001316,-96.555152]]},{RegionID:"MP",Name:"Northern Mariana Islands",Bounds:[[14.105276,144.89859],[20.556385,145.870788]]},{RegionID:"OH",Name:"Ohio",Bounds:[[38.4025,-84.819931],[42.324424,-80.51387]]},{RegionID:"OK",Name:"Oklahoma",Bounds:[[33.615253,-103.000869],[37.00093,-94.430702]]},{RegionID:"OR",Name:"Oregon",Bounds:[[41.992462,-124.566024],[46.285762,-116.461639]]},{RegionID:"PA",Name:"Pennsylvania",Bounds:[[39.719429,-80.519561],[42.510452,-74.690032]]},{RegionID:"PR",Name:"Puerto Rico",Bounds:[[17.922222,-67.938339],[18.519443,-65.241958]]},{RegionID:"RI",Name:"Rhode Island",Bounds:[[41.144325,-71.888366],[42.0191,-71.120613]]},{RegionID:"SC",Name:"South Carolina",Bounds:[[32.049209,-83.354354],[35.21611,-78.55368]]},{RegionID:"SD",Name:"South Dakota",Bounds:[[42.481113,-104.057128],[45.944362,-96.436576]]},{RegionID:"TN",Name:"Tennessee",Bounds:[[34.983898,-90.310745],[36.679244,-81.647453]]},{RegionID:"TX",Name:"Texas",Bounds:[[25.83802,-106.645782],[36.50344,-93.508743]]},{RegionID:"UT",Name:"Utah",Bounds:[[36.99863,-114.054069],[42.004196,-109.040946]]},{RegionID:"VT",Name:"Vermont",Bounds:[[42.727611,-73.443428],[45.016334,-71.467712]]},{RegionID:"VA",Name:"Virginia",Bounds:[[36.539142,-83.674819],[39.466579,-75.240722]]},{RegionID:"VI",Name:"Virgin Islands",Bounds:[[17.676666,-65.026947],[18.377777,-64.560287]]},{RegionID:"WA",Name:"Washington",Bounds:[[45.553112,-124.75579],[49.00362,-116.912506]]},{RegionID:"WV",Name:"West Virginia",Bounds:[[37.202762,-82.640777],[40.638553,-77.719734]]},{RegionID:"WI",Name:"Wisconsin",Bounds:[[42.494701,-92.885391],[47.302532,-86.249565]]},{RegionID:"WY",Name:"Wyoming",Bounds:[[40.996269,-111.055137],[45.004203,-104.051986]]},{RegionID:"CRB",Name:"Connecticut River Basin",Bounds:[[43,-70.5],[44,-74.5]]},{RegionID:"DRB",Name:"Delaware River Basin",Bounds:[[38.5,-73],[42.5,-77]]},{RegionID:"RRB",Name:"Rainy River Basin",Bounds:[[47.3,-89.5],[50,-96]]}];var StreamStats;!function(e){var t;!function(e){var t=function(){function e(e,t){this.RegionID=e,this.Pourpoint=t}return e}();e.StudyArea=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,r){return new a(e,t,r)}var r=function(){function e(){}return e}();e.StatisticsGroup=r;var a=function(e){function t(t,r,a){e.call(this,t,configuration.baseurls.NSS),this.$q=r,this.toaster=a,this._onselectedStatisticsGroupChanged=new WiM.Event.Delegate,this.statisticsGroupList=[],this.selectedStatisticsGroupParameterList=[],this.selectedStatisticsGroupScenarioResults=[],this.canUpdate=!0}return __extends(t,e),Object.defineProperty(t.prototype,"onselectedStatisticsGroupChanged",{get:function(){return this._onselectedStatisticsGroupChanged},enumerable:!0,configurable:!0}),t.prototype.loadStatisticsGroupTypes=function(e,t){var r=this;if(this.toaster.pop("info","Loading Available Scenarios","Please wait...",999999),console.log("in load StatisticsGroups",e),e||t){var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),s=new WiM.Services.Helpers.RequestInfo(a,!0);this.statisticsGroupList=[],this.Execute(s).then(function(e){var t=r.statisticsGroupList;angular.forEach(e.data,function(e,r){t.push(e)})},function(e){})["finally"](function(){r.toaster.clear()})}},t.prototype.loadParametersByStatisticsGroup=function(e,t,r){var a=this;if(this.toaster.pop("info","Load Parameters by Scenario","Please wait...",999999),console.log("in load StatisticsGroup parameters",e,t,r),e||t||r){var s=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup.format(e,t,r),o=new WiM.Services.Helpers.RequestInfo(s,!0);this.selectedStatisticsGroupParameterList=[],this.Execute(o).then(function(e){e.data[0].RegressionRegions[0].Parameters&&e.data[0].RegressionRegions[0].Parameters.length>0&&(a.selectedStatisticsGroupScenario=e.data,e.data[0].RegressionRegions[0].Parameters.map(function(e){try{a.selectedStatisticsGroupParameterList.push(e)}catch(t){alert(t)}}))},function(e){})["finally"](function(){a.toaster.clear()})}},t.prototype.estimateFlows=function(e,t,r,a){var s=this;if(this.toaster.pop("info","Estimating Flows","Please wait...",999999),this.canUpdate=!1,e||t||r||a){console.log("in estimate flows method"),this.selectedStatisticsGroupScenario[0].RegressionRegions[0].Parameters.map(function(t){angular.forEach(e,function(e,r){t.Code.toLowerCase()==e.code.toLowerCase()&&(console.log("updating parameter in scenario object for: ",t.Code," from: ",t.Value," to: ",e.value),t.Value=e.value)})});var o=JSON.stringify(this.selectedStatisticsGroupScenario,null);console.log("updated scenario object: ",o);var i=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(t,r,a),n=new WiM.Services.Helpers.RequestInfo(i,!0,1,"json",o);this.selectedStatisticsGroupScenarioResults=[],this.Execute(n).then(function(e){e.data[0].RegressionRegions[0].Results&&e.data[0].RegressionRegions[0].Results.length>0&&e.data[0].RegressionRegions[0].Results.map(function(e){try{s.selectedStatisticsGroupScenarioResults.push(e)}catch(t){alert(t)}})},function(e){})["finally"](function(){s.toaster.clear(),s.canUpdate=!0})}},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t){return new s(e,t)}var r=function(){function e(){}return e}();e.Region=r;var a=function(){function e(){}return e}();e.Parameter=a;var s=function(e){function t(t,r){e.call(this,t,configuration.baseurls.StreamStats),this.$q=r,this._onSelectedRegionChanged=new WiM.Event.Delegate,this.regionList=[],this.parameterList=[],this.masterRegionList=configuration.regions}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedRegionChanged",{get:function(){return this._onSelectedRegionChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(e){this._selectedRegion!=e&&(this._selectedRegion=e,this._onSelectedRegionChanged.raise(null,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),t.prototype.loadRegionListByExtent=function(e,t,r,a,s){var o=this;void 0===s&&(s=4326),this.regionList.length=0;var i={f:"json",geometry:{xmin:e,ymin:r,xmax:t,ymax:a,spatialReference:{wkid:s}},tolerance:2,returnGeometry:!1,mapExtent:{xmin:e,ymin:r,xmax:t,ymax:a,spatialReference:{wkid:s}},imageDisplay:"1647, 457,96",geometryType:"esriGeometryEnvelope",sr:s,layers:"all: 4"},n=configuration.baseurls.StreamStats+configuration.queryparams.regionService,l=new WiM.Services.Helpers.RequestInfo(n,!0,0,"json");l.params=i,this.Execute(l).then(function(e){e.data.results.map(function(e){try{var t=o.getRegion(e.attributes.st_abbr);null!=t&&-1==o.regionList.indexOf(t)&&o.regionList.push(t)}catch(r){alert(r)}})},function(e){return o.$q.reject(e.data)})},t.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null==t?!1:(this.regionList.push(t),!0)},t.prototype.loadMapLayersByRegion=function(e){var t=this,r=configuration.baseurls.StreamStats+configuration.queryparams.SSStateLayers.format(e.toLowerCase()),a=new WiM.Services.Helpers.RequestInfo(r,!0,0,"json"),s=[];this.Execute(a).then(function(e){return angular.forEach(e.data.layers,function(e,t){(-1!=e.name.toLowerCase().indexOf("stream grid")||-1!=e.name.toLowerCase().indexOf("study area bndys"))&&(console.log(e),s.push(e.id))}),s},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)})},t.prototype.loadParametersByRegion=function(){var e=this;if(console.log("in load parameters",this.selectedRegion),this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){t.data.parameters&&t.data.parameters.length>0&&t.data.parameters.map(function(t){try{e.parameterList.push(t)}catch(r){alert(r)}})},function(e){console.log("Bad response from the regression service")})["finally"](function(){})}},t.prototype.getRegion=function(e){var t=configuration.regions;try{for(var r=0;r<t.length;r++)if(t[r].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[r].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[r];return null}catch(a){return null}},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,a){return new r(e,t,a)}var r=function(e){function t(t,r,a){e.call(this,t,configuration.baseurls.StreamStats),this.$q=r,this._onSelectedStudyAreaChanged=new WiM.Event.Delegate,this.toaster=a,this._studyAreaList=[],this.canUpdate=!0,this.parametersLoaded=!1,this.parametersLoading=!1,this.doDelineateFlag=!1,this.studyAreaParameterList=[]}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedStudyAreaChanged",{get:function(){return this._onSelectedStudyAreaChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),t.prototype.AddStudyArea=function(e){this.StudyAreaList.push(e),this.selectedStudyArea=e},t.prototype.RemoveStudyArea=function(){},t.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("info","Delineating Basin","Please wait...",999999),this.canUpdate=!1;var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString(),!1),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){e.selectedStudyArea.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null},function(e){})["finally"](function(){e.toaster.clear(),e.canUpdate=!0,e._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)})},t.prototype.loadParameters=function(){var e=this;if(this.toaster.pop("info","Calculating Selected Parameters","Please wait...",999999),console.log("in load parameters"),this.parametersLoading=!0,this.parametersLoaded=!1,!this.selectedStudyArea||!this.selectedStudyArea.WorkspaceID||!this.selectedStudyArea.RegionID)return void alert("No Study Area");var t=[];this.studyAreaParameterList.map(function(e){t.push(e.code)});var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,t.join(",")),a=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(a).then(function(t){if(t.data.parameters&&t.data.parameters.length>0){var r=t.data.parameters;e.loadParameterResults(r),e.parametersLoaded=!0}},function(e){})["finally"](function(){e.toaster.clear(),e.parametersLoading=!1})},t.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("info","Checking for Upstream Regulation","Please wait..."),this.isRegulated=!1,this.canUpdate=!1;var t=JSON.stringify(this.selectedStudyArea.Features[1].feature,null),r=configuration.baseurls.RegulationServices+configuration.queryparams.COregulationService,a=new WiM.Services.Helpers.RequestInfo(r,!0,1,"json",{watershed:t,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){if(console.log(t),t.data.percentarearegulated>0){e.toaster.pop("success","Regulation was found","Continue to 'Modify Parameters' to see area-weighted parameters",5e3),e.selectedStudyArea.Features.push(t.data.featurecollection[0]);var r=t.data.parameters;e.loadRegulatedParameterResults(r),e.isRegulated=!0}else e.toaster.pop("warning","No regulation found","Please continue",5e3)},function(e){})["finally"](function(){e.canUpdate=!0,e._onSelectedStudyAreaChanged.raise(null,WiM.Event.EventArgs.Empty)})},t.prototype.loadParameterResults=function(e){this.toaster.pop("info","Loading Parameters","Please wait..."),console.log("in load parameter results");var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,r){return e.code.toUpperCase().trim()===t.code.toUpperCase().trim()?void(t.value=e.value):void 0})}),console.log("params",this.studyAreaParameterList)},t.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("info","Loading Regulated Parameters","Please wait..."),console.log("in load regulated parameter results");var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,r){return e.code.toUpperCase().trim()===t.code.toUpperCase().trim()?void(t.regulatedValue=e.value):void 0})}),console.log("regulated params",this.studyAreaParameterList)},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strict";function t(e){return new r(e)}var r=function(){function e(e){this.modal=e}return e.prototype.openReport=function(){console.log("in report open function");this.modal.open({templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"})},e}();t.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ReportService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){var t;!function(t){var r=function(){function e(){this.lat=0,this.lng=0}return e}(),a=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),s=function(){function e(e,t,r,a,s){void 0===s&&(s=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=s}return e}(),o=function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}(),i=function(){function t(e,t,r,a,s,o,i,n){var l=this;this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.controls=null,this.markers=null,this.geojson=null,this.events=null,this.regionLayer=null,e.vm=this,this.init(),this.searchService=o,this.$locationService=t,this.regionServices=i,this.leafletBoundsHelperService=a,this.leafletData=s,this.studyArea=n,o.onSelectedAreaOfInterestChanged.subscribe(this._onSelectedAreaOfInterestHandler),i.onSelectedRegionChanged.subscribe(this._onSelectedRegionHandler),n.onSelectedStudyAreaChanged.subscribe(this._onSelectedStudyAreaHandler),e.$on("leafletDirectiveMap.load",function(e,t){l.leafletData.getMap().then(function(e){console.log("map load",e)})}),e.$on("leafletDirectiveMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;l.mapPoint.lat=r.lat,l.mapPoint.lng=r.lng}),e.$on("leafletDirectiveMap.click",function(e,t){if(n.doDelineateFlag){var r=t.leafletEvent.latlng;l.startDelineate(r),n.doDelineateFlag=!1}}),e.$watch(function(){return l.bounds},function(e,t){return l.setRegionsByBounds(t,e)}),e.$on("$locationChangeStart",function(){return l.updateRegion()}),e.$watch(function(){return n.doDelineateFlag},function(e,t){return e?l.cursorStyle="crosshair":l.cursorStyle="hand"}),r.region&&this.setBoundsByRegion(r.region)}return t.prototype.init=function(){var e=this;this._onSelectedAreaOfInterestHandler=new WiM.Event.EventHandler(function(t,r){e.onSelectedAreaOfInterestChanged(t,r)}),this._onSelectedRegionHandler=new WiM.Event.EventHandler(function(){e.onSelectedRegionChanged()}),this._onSelectedStudyAreaHandler=new WiM.Event.EventHandler(function(){e.onSelectedStudyAreaChanged()}),this.center=new a(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers,markers:this.markers,geojson:this.geojson},this.mapDefaults=new o(null,3,!1),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,custom:new Array(L.Control.zoomHome({homeCoordinates:[39,-100],homeZoom:4}),L.control.locate({follow:!0}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){var r=t.selectedAreaOfInterest;this.markers.AOI={lat:r.Latitude,lng:r.Longitude,message:r.Name,focus:!0,draggable:!1},this.center=new a(r.Latitude,r.Longitude,14)},t.prototype.onSelectedRegionChanged=function(){this.removeOverlayLayers("_region",!0),this.addRegionOverlayLayers(this.regionServices.selectedRegion.RegionID)},t.prototype.onSelectedStudyAreaChanged=function(){var e=this;if(this.studyArea.selectedStudyArea.Features){var t=this.studyArea.selectedStudyArea.Pourpoint.Latitude,r=this.studyArea.selectedStudyArea.Pourpoint.Longitude,a=this.studyArea.selectedStudyArea.RegionID,s=this.studyArea.selectedStudyArea.WorkspaceID;this.studyArea.selectedStudyArea.Features.forEach(function(o){console.log("in onselectedstudyarea changed",o.name),"globalwatershed"==o.name&&(e.geojson[o.name]={data:o.feature,style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}),"globalwatershedpoint"==o.name&&(e.geojson[o.name]={data:o.feature,onEachFeature:function(e,o){var i="<strong>Latitude: </strong>"+t+"</br><strong>Longitude: </strong>"+r+"</br><strong>Region: </strong>"+a+"</br><strong>WorkspaceID: </strong>"+s+"</br>";angular.forEach(e.properties,function(e,t){i+="<strong>"+t+": </strong>"+e+"</br>"}),o.bindPopup(i)}}),"regulatedWatershed"==o.name&&(console.log("showing regulated watershed"),e.geojson[o.name]={data:o.feature,style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}})}),console.log("geojson",this.geojson),this.markers={};var o=this.geojson.globalwatershed.data.features[0].bbox;this.leafletData.getMap().then(function(e){e.fitBounds([[o[1],o[0]],[o[3],o[2]]],{})})}},t.prototype.setRegionsByBounds=function(e,t){this.center.zoom>=14&&e!==t&&this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat)},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds),this.center={})},t.prototype.addRegionOverlayLayers=function(e){this.layers.overlays[e+"_region"]=new s(e+" Region",configuration.baseurls.StreamStats+"/arcgis/rest/services/{0}_ss/MapServer".format(e.toLowerCase()),"agsDynamic",!0,{opacity:.5,layers:this.regionServices.loadMapLayersByRegion(e)});var t=configuration.customMapServices[e];if(void 0!=t)for(var r in t)this.layers.overlays[r+"_region"]=t[r]},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.layers.overlays,t),a.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var s in t)t[s].hasOwnProperty("name")&&(r?t[s].name.indexOf(e)>-1:t[s].name===e)&&a.push(s);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var s in t)(r?s.indexOf(e)>-1:s===e)&&a.push(s);return a},t.prototype.startDelineate=function(t){console.log("in startDelineate",t),this.markers.pourpoint={lat:t.lat,lng:t.lng,message:"New Pourpoint</br><strong>Latitude: </strong>"+t.lat+"</br><strong>Longitude: </strong>"+t.lng,focus:!1,draggable:!1};var r=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(r),this.studyArea.loadStudyBoundary()},t.$inject=["$scope","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",i)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t,r=function(){function e(e,t,r,a,s,o,i){var n=this;e.vm=this,this.toaster=t,this.searchService=r,this.sideBarCollapsed=!1,this.selectedProcedure=1,this.regionService=a,this.regionList=a.regionList,this.masterRegionList=a.masterRegionList,this.nssService=o,this.studyAreaService=s,
this.reportService=i,e.$watchCollection(function(){return n.nssService.selectedStatisticsGroupParameterList},function(e,t){console.log("StatisticsGroup param list changed.  loaded ",e.length," parameters from StatisticsGroup"),n.studyAreaService.studyAreaParameterList=[],n.regionService.parameterList.map(function(e){angular.forEach(o.selectedStatisticsGroupParameterList,function(t,r){e.code.toLowerCase()==t.Code.toLowerCase()&&s.studyAreaParameterList.push(e)})})})}return e.prototype.getLocations=function(e){return this.searchService.getLocations(e)},e.prototype.setProcedureType=function(e){console.log("in setProcedureType",this.selectedProcedure,e,!this.canUpdateProcedure(e)),this.selectedProcedure!=e&&this.canUpdateProcedure(e)&&(this.selectedProcedure=e)},e.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},e.prototype.onAOISelect=function(e){this.searchService.onSelectedAreaOfInterestChanged.raise(this,new WiM.Services.SearchAPIEventArgs(e))},e.prototype.zoomRegion=function(e){var t=JSON.parse(e);console.log("here1",t)},e.prototype.setRegion=function(e){console.log("here1",e),(void 0==this.regionService.selectedRegion||this.regionService.selectedRegion.RegionID!==e.RegionID)&&(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},e.prototype.startDelineate=function(){this.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),this.studyAreaService.selectedStudyArea=null,this.studyAreaService.studyAreaParameterList=[],this.studyAreaService.parametersLoading=!1,this.studyAreaService.parametersLoaded=!1,this.nssService.statisticsGroupList=[],this.nssService.selectedStatisticsGroup=null,this.nssService.selectedStatisticsGroupParameterList=[],this.nssService.selectedStatisticsGroupScenario=[],this.nssService.selectedStatisticsGroupScenarioResults=[],this.studyAreaService.doDelineateFlag=!this.studyAreaService.doDelineateFlag},e.prototype.setStatisticsGroup=function(e){return this.nssService.selectedStatisticsGroup==e?(this.nssService.selectedStatisticsGroup=null,void(this.studyAreaService.studyAreaParameterList=[])):(this.nssService.selectedStatisticsGroup=e,console.log(e.Name," clicked"),this.studyAreaService.studyAreaParameterList=[],this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,this.nssService.selectedStatisticsGroup.ID,this.studyAreaService.selectedStudyArea.RegressionRegions[0]),void this.nssService.selectedStatisticsGroupParameterList)},e.prototype.updateStudyAreaParameterList=function(e){var t=this.studyAreaService.studyAreaParameterList.indexOf(e);t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):this.studyAreaService.studyAreaParameterList.push(e)},e.prototype.calculateParameters=function(){this.studyAreaService.loadParameters()},e.prototype.queryRegressionRegions=function(){console.log("in Query Regression Regions"),this.setProcedureType(3),this.studyAreaService.selectedStudyArea.RegressionRegions=["290"],this.queryStatisticGroups()},e.prototype.queryStatisticGroups=function(){console.log("in Query Statistics Groups"),this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions[0])},e.prototype.estimateFlows=function(e){console.log("in estimateFlows"),this.nssService.estimateFlows(e,this.regionService.selectedRegion.RegionID,this.nssService.selectedStatisticsGroup.ID,this.studyAreaService.selectedStudyArea.RegressionRegions[0]),this.reportService.openReport()},e.prototype.checkRegulation=function(){return console.log("berp",this.studyAreaService.studyAreaParameterList.length,this.studyAreaService.parametersLoaded),this.studyAreaService.studyAreaParameterList.length<1||!this.studyAreaService.parametersLoaded?void alert("Select some parameters and make sure they are calcuated"):void this.studyAreaService.upstreamRegulation()},e.prototype.canUpdateProcedure=function(e){try{switch(e){case 1:return!0;case 2:return null!=this.regionService.selectedRegion;case 3:return null!=this.regionService.selectedRegion;case 4:return this.studyAreaService.studyAreaParameterList.length>0;case 5:return this.nssService.selectedStatisticsGroupParameterList.length>0;default:return!1}}catch(t){return!1}},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope","toaster","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ReportService"],e}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.REFINE=4]="REFINE",e[e.BUILD=5]="BUILD"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,r){e.vm=this,this.reportService=t}return e.prototype.openReport=function(){console.log("here"),this.reportService.openReport()},e.$inject=["$scope","StreamStats.Services.ReportService","StreamStats.Services.StudyAreaService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),r=function(){function e(e,t,r,a,s){var o=this;this.markers=null,this.geojson=null,this.center=null,this.layers=null,e.vm=this,this.studyAreaService=r,this.nssService=a,this.leafletData=s,this.reportTitle="Report Title",this.reportComments="Some comments here",this.initMap(),console.log("testtest"),e.$on("leafletDirectiveMap.load",function(e,t){console.log("report map load"),o.showFeatures()}),this.close=function(){t.dismiss("cancel")},this.print=function(){window.print()}}return e.prototype.initMap=function(){this.center=new t(39,-96,4),this.layers={baselayers:configuration.basemaps,geojson:this.geojson},this.geojson={},L.Icon.Default.imagePath="images"},e.prototype.showFeatures=function(){var e=this;this.studyAreaService.selectedStudyArea&&(this.geojson={},this.studyAreaService.selectedStudyArea.Features.forEach(function(t){if(console.log("in each loop",t.name),"globalwatershed"==t.name){e.geojson[t.name]={data:t.feature,style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}};var r=e.geojson.globalwatershed.data.features[0].bbox;e.leafletData.getMap().then(function(e){e.invalidateSize(),console.log("in getmap: ",r),e.fitBounds([[r[1],r[0]],[r[3],r[2]]]),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.boxZoom.disable(),e.keyboard.disable(),e.tap&&e.tap.disable(),document.getElementById("map").style.cursor="default"})}"globalwatershedpoint"==t.name&&(e.geojson[t.name]={data:t.feature}),"regulatedWatershed"==t.name&&(console.log("showing regulated watershed"),e.geojson[t.name]={data:t.feature,style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}})}))},e.$inject=["$scope","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));